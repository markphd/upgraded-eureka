!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.xstate=e():t.xstate=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,n){"use strict";function i(t){try{return"string"==typeof t||"number"==typeof t?""+t:t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function a(t){try{return Array.isArray(t)?t:t.toString().split(".")}catch(e){throw new Error("'"+t+"' is not a valid state path.")}}function r(t){if(t instanceof s.State)return t.value;if("object"==typeof t&&!(t instanceof s.State))return t;var e=a(t);if(1===e.length)return e[0];for(var n={},i=n,r=0;r<e.length-1;r++)r===e.length-2?i[e[r]]=e[r+1]:(i[e[r]]={},i=i[e[r]]);return n}function o(t,e){var n={};return Object.keys(t).forEach(function(i){n[i]=e(t[i],i,t)}),n}Object.defineProperty(e,"__esModule",{value:!0});var s=n(2);e.getEventType=i,e.toStatePath=a,e.toTrie=r,e.mapValues=o},function(t,e,n){"use strict";function i(t){return new l(t)}var a=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t};Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),o=n(3);e.matchesState=o.default;var s=n(6);e.mapState=s.default;var c=n(2);e.State=c.State;var u=n(7),f=".",l=function(){function t(e){var n=this;this.config=e,this.__cache={events:void 0,relativeValue:new Map,initialState:void 0},this.key=e.key||"(machine)",this.parent=e.parent,this.machine=this.parent?this.parent.machine:this,this.id=this.parent?this.parent.id+f+this.key:this.key,this.relativeId=this.parent&&this.parent.parent?this.parent.relativeId+f+this.key:this.key,this.initial=e.initial,this.parallel=!!e.parallel,this.states=e.states?r.mapValues(e.states,function(e,i){return new t(a({},e,{key:i,parent:n}))}):{},this.on=e.on,this.strict=!!e.strict,this.onEntry=e.onEntry?[].concat(e.onEntry):void 0,this.onExit=e.onExit?[].concat(e.onExit):void 0,this.data=e.data,this.activities=e.activities}return t.prototype.getStateNodes=function(t){var e=this,n=t instanceof c.State?t.value:r.toTrie(t);if("string"==typeof n){var i=this.states[n].initial;return i?this.getStateNodes((o={},o[n]=i,o)):[this.states[n]]}var a=Object.keys(n);return a.map(function(t){return e.states[t]}).concat(a.map(function(t){return e.states[t].getStateNodes(n[t])}).reduce(function(t,e){return t.concat(e)}));var o},t.prototype.handles=function(t){var e=r.getEventType(t);return!!this.on&&e in this.on},t.prototype.transition=function(t,e,n){if(this.strict){var i=r.getEventType(e);if(-1===this.events.indexOf(i))throw new Error("Machine '"+this.id+"' does not accept event '"+i+"'")}var a=this.transitionStateValue(t,e,n),o=this.stateTransitionToState(a,t);if(!o)return c.State.inert(t);var s,u=o;do{s=u,u=this.stateTransitionToState(this.transitionStateValue(s,"",n),s)}while(u);return s},t.prototype.stateTransitionToState=function(t,e){var n=t.stateValue,i=t.actions,r=t.activities;if(n){var o=e instanceof c.State?e.activities:void 0,s=a({},o,r);return new c.State(n,c.State.from(e),i?i.onExit.concat(i.actions).concat(i.onEntry):[],s,this.getStateNodes(n).reduce(function(t,e){return t[e.id]=e.data,t},{}))}},t.prototype.transitionStateValue=function(t,e,n){var i=this,o=t instanceof c.State?t.history:void 0,s=r.toTrie(t);if("string"==typeof s){if(!this.states[s])throw new Error("State '"+s+"' does not exist on machine '"+this.id+"'");var u=this.states[s];if(!u.states||!u.initial)return u.next(e,o?o.value:void 0,n);var f=u.initialState.value;m={},m[s]=f,s=m}var l=[],h=r.mapValues(s,function(t,a){var r=o?o.value[a]:void 0,s=new c.State(t,r?c.State.from(r):void 0),u=i.states[a],f=u.transitionStateValue(s,e,n);return f.stateValue||l.push(u.next(e,o?o.value:void 0,n)),f});if(Array.prototype.every.call(Object.keys(h),function(t){return void 0===h[t].stateValue})){if(this.parallel)return l.length?l[0]:{stateValue:void 0,actions:{onEntry:[],onExit:[],actions:[]},activities:void 0};var v=Object.keys(h)[0],p=this.states[v].next(e,o?o.value:void 0,n),y=p.stateValue,d=p.actions,E=p.activities,g=h[v].actions,S=h[v].activities,b=a({},S,E);return{stateValue:y,actions:d?g?{onEntry:g.onEntry.concat(d.onEntry),actions:g.actions.concat(d.actions),onExit:g.onExit.concat(d.onExit)}:d:g,activities:b}}this.parallel&&(h=a({},r.mapValues(this.initialState.value,function(t){return{stateValue:t,actions:{onEntry:[],onExit:[],actions:[]},activities:void 0}}),h));var x={onEntry:[],actions:[],onExit:[]},_={};return{stateValue:r.mapValues(h,function(t,e){var n=t.stateValue,i=t.actions,a=t.activities;return i&&(i.onEntry&&(r=x.onEntry).push.apply(r,i.onEntry),i.actions&&(o=x.actions).push.apply(o,i.actions),i.onExit&&(c=x.onExit).push.apply(c,i.onExit)),a&&Object.assign(_,a),n||s[e];var r,o,c}),actions:x,activities:_};var m},t.prototype.next=function(t,e,n){var i=this,o=r.getEventType(t),s={onEntry:[],onExit:[],actions:[]},c={};if(this.onExit&&(s.onExit=this.onExit),this.activities&&this.activities.forEach(function(t){c[r.getEventType(t)]=!1,s.onExit=s.onExit.concat(u.stop(t))}),!this.on||!this.on[o])return{stateValue:void 0,actions:s,activities:c};var l,h=this.on[o];if("string"==typeof h)l=h;else for(var v=Array.isArray(h)?h:Object.keys(h).map(function(t){return a({},h[t],{target:t})}),p=0,y=v;p<y.length;p++){var d=y[p],E=d,g=E.cond,S=E.actions,b=n||{},x="string"==typeof t||"number"==typeof t?{type:t}:t;if(!g||g(b,x)){l=d.target,S&&(s.actions=s.actions.concat(S));break}}if(!l)return{stateValue:void 0,actions:s,activities:c};var _=r.toStatePath(l),m=this.parent,T=e,V=this.key;if(_.forEach(function(e){if(!m||!m.states)throw new Error("Unable to read '"+e+"'");if("$history"===e)if(T)e="object"==typeof T?Object.keys(T)[0]:T;else{if(!m.initial)throw new Error("Cannot read '$history' from state '"+m.id+"': missing 'initial'");e=m.initial}else if(""===e)return s.onExit=[],void(m=m.states[i.key]);if(void 0===(m=m.states[e]))throw new Error("Event '"+t+"' on state '"+V+"' leads to undefined state '"+_.join(f)+"'.");m.onEntry&&(s.onEntry=s.onEntry.concat(m.onEntry)),m.activities&&m.activities.forEach(function(t){c[r.getEventType(t)]=!0,s.onEntry=s.onEntry.concat(u.start(t))}),V=e,T&&(T=T[e])}),!m)throw new Error("no state");for(;m.initial;){if(!m||!m.states)throw new Error("Invalid initial state");m=m.states[m.initial],m.onEntry&&(s.onEntry=s.onEntry.concat(m.onEntry)),m.activities&&m.activities.forEach(function(t){c[r.getEventType(t)]=!0,s.onEntry=s.onEntry.concat(u.start(t))})}return{stateValue:m.getRelativeValue(this.parent),actions:s,activities:c}},Object.defineProperty(t.prototype,"resolvedStateValue",{get:function(){var t=this.key;return this.parallel?(e={},e[t]=r.mapValues(this.states,function(t){return t.resolvedStateValue[t.key]}),e):this.initial?(n={},n[t]=this.states[this.initial].resolvedStateValue,n):t;var e,n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var t=this.__cache.initialState||(this.parallel?r.mapValues(this.states,function(t){return t.initialStateValue}):this.resolvedStateValue[this.key]);return this.__cache.initialState=t,this.__cache.initialState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '"+this.id+".'");var e=this.getStateNodes(t).reduce(function(t,e){return e.onEntry?t.concat(e.onEntry):t},[]);return new c.State(t,void 0,e)},enumerable:!0,configurable:!0}),t.prototype.getStates=function(t){var e=this;if("string"==typeof t)return[this.states[t]];var n=[];return Object.keys(t).forEach(function(i){n.push.apply(n,e.states[i].getStates(t[i]))}),n},t.prototype.getState=function(t){var e=r.toStatePath(t);try{return e.reduce(function(t,e){if(!t.states)throw new Error("Cannot retrieve subPath '"+e+"' from node with no states");return t.states[e]},this)}catch(e){throw new Error("State '"+t+" does not exist on machine '"+this.id+"'")}},Object.defineProperty(t.prototype,"events",{get:function(){if(this.__cache.events)return this.__cache.events;var t=this.states,e=new Set(this.on?Object.keys(this.on):void 0);return t&&Object.keys(t).forEach(function(n){var i=t[n];if(i.states)for(var a=0,r=i.events;a<r.length;a++){var o=r[a];e.add(""+o)}}),this.__cache.events=Array.from(e)},enumerable:!0,configurable:!0}),t.prototype.getRelativeValue=function(t){var e=t?this.__cache.relativeValue.get(t):void 0;if(e)return e;for(var n=this.initialStateValue,i=n?(s={},s[this.key]=n,s):this.key,r=this.parent;r&&r!==t;){var o=r.initialStateValue;c={},c[r.key]=r.parallel&&"object"==typeof o&&"object"==typeof i?a({},o,i):i,i=c,r=r.parent}return this.__cache.relativeValue.set(t,i),i;var s,c},t}();e.StateNode=l,e.Machine=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),a=n(0),r=function(){function t(t,e,n,a,r){void 0===n&&(n=[]),void 0===a&&(a=i.EMPTY_ACTIVITY_MAP),void 0===r&&(r={}),this.value=t,this.history=e,this.actions=n,this.activities=a,this.data=r}return t.from=function(e){return e instanceof t?e:new t(a.toTrie(e))},t.inert=function(e){return e instanceof t?e.actions.length?new t(e.value,e.history,[]):e:t.from(e)},t.prototype.toString=function(){if("string"==typeof this.value)return this.value;for(var t=[],e=this.value;;){if("string"==typeof e){t.push(e);break}var n=Object.keys(e),a=n[0];if(n.slice(1).length)return;t.push(a),e=e[a]}return t.join(i.STATE_DELIMITER)},t}();e.State=r},function(t,e,n){"use strict";function i(t,e){var n=a.toTrie(t),r=a.toTrie(e);return"string"==typeof r?"string"==typeof n?r===n:r in n:"string"==typeof n?n in r:Object.keys(n).every(function(t){return t in r&&i(n[t],r[t])})}Object.defineProperty(e,"__esModule",{value:!0});var a=n(0);e.default=i},function(t,e,n){n(1),t.exports=n(1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STATE_DELIMITER=".",e.EMPTY_ACTIVITY_MAP={}},function(t,e,n){"use strict";function i(t,e){var n;return Object.keys(t).forEach(function(t){a.default(t,e)&&(!n||e.length>n.length)&&(n=t)}),t[n]}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3);e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.actionTypes={start:"xstate.start",stop:"xstate.stop",raise:"xstate.raise",send:"xstate.send",cancel:"xstate.cancel"};var a=function(t){return function(e){var n="string"==typeof e||"number"==typeof e?{type:e}:e;return{type:t,activity:i.getEventType(e),data:n}}},r=function(t){return"string"==typeof t||"number"==typeof t?{type:t}:t};e.raise=function(t){return{type:e.actionTypes.raise,event:t}},e.send=function(t,n){return{type:e.actionTypes.send,event:r(t),delay:n?n.delay:void 0,id:n&&void 0!==n.id?n.id:i.getEventType(t)}},e.cancel=function(t){return{type:e.actionTypes.cancel,sendId:t}},e.start=a(e.actionTypes.start),e.stop=a(e.actionTypes.stop)}])});